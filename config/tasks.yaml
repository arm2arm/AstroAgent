# ============================================================================
# Task Templates — CrewAI 1.9x YAML Configuration
# ============================================================================
# Each top-level key is a task identifier referenced in Python code.
# Supports {variable} placeholders resolved at runtime via str.format().
#
# Fields: description, expected_output, agent (optional — set in Python)
# ============================================================================

planning_task:
  description: >
    Create a detailed plan for this task:
    "{research_question}"

    {memory_context}

    Your plan should include:
    1. Inputs and assumptions
    2. Data handling steps (if any)
    3. Key implementation steps
    4. Expected outputs

    Be specific and practical.
  expected_output: >
    Detailed analysis plan with clear steps

analysis_task:
  description: >
    Design the analysis approach for this plan:

    {analysis_plan}

    {memory_context}

    Specify:
    1. Methods to use
    2. Visualization strategies (plots, diagrams)
    3. Quality checks and validation
    4. Expected outputs

    Focus on practical, executable steps.
  expected_output: >
    Statistical analysis strategy with methods

coding_task:
  description: >
    Generate a complete, self-contained Python script for:
    "{research_question}"

    {context}
    {revision_hint}

    CRITICAL requirements:
    - Use ONLY these libraries (already installed): {pre_install}
    - PRINT all key results to stdout.
    - Write FLAT executable code that runs top-to-bottom.
      If you define helper functions, you MUST call them:
        if __name__ == "__main__":
            main()
    - Include proper error handling.
    - The script must work standalone (no external data files
      unless explicitly requested).
    - For simple tasks use numpy/scipy to generate data directly —
      do NOT fetch remote datasets.

    ONLY if the task involves plotting or visualization:
    - Set up matplotlib for headless rendering:
        import matplotlib
        matplotlib.use("Agg")
        import matplotlib.pyplot as plt
    - Save ALL plots to the CURRENT WORKING DIRECTORY:
        plt.savefig("descriptive_name.png", dpi=150, bbox_inches="tight")
        print("SAVED: descriptive_name.png")
    - NEVER call plt.show()

    If the task does NOT involve plotting, do NOT import matplotlib
    or produce image files. Printed results are valid output.

    Return ONLY the Python code inside a ```python code fence.
  expected_output: >
    Complete executable Python script

review_task:
  description: >
    Review this Python code AND its execution output.
    The ORIGINAL USER REQUEST was: "{research_question}"

    --- CODE ---
    {generated_code}

    --- EXECUTION OUTPUT ---
    {exec_summary}
    {artifact_info}
    {memory_context}

    Check:
    1. Did the code execute without errors?
    2. Does the code address the ORIGINAL USER REQUEST?
    3. If the task required plots/images:
       a. Does every plt.plot/scatter/bar have a matching plt.savefig()?
       b. Were expected output files actually produced? (see GENERATED FILES)
       c. If NO output files for a plotting task → NEEDS REVISION.
    4. If the task did NOT require plots, do NOT reject just because
       no image files were produced. Printed results are valid output.
    5. Are all defined functions actually called (not just defined)?
    6. Does stdout contain meaningful output?

    IMPORTANT: If the code ran successfully and produced correct
    results matching the user's request, mark it APPROVED. Only
    reject if there are real errors or clearly wrong results.

    End your review with EXACTLY one of these verdicts on its own line:
    APPROVED
    NEEDS REVISION

    If NEEDS REVISION, list the specific issues as bullet points.
  expected_output: >
    Code review report ending with APPROVED or NEEDS REVISION

summarization_task:
  description: >
    Summarize the following {label} into <= {target_tokens} tokens.
    Preserve constraints, data details, and actionable steps.
    Output concise bullet points.

    CONTENT:
    {content}
  expected_output: >
    Concise bullet summary
